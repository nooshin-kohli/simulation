#! /usr/bin/env python3.6 

# AUTHOR : kohli , yazdi

import numpy as np
import rospy
from numpy import ndarray
from rospy.numpy_msg import numpy_msg
from sensor_msgs.msg import JointState
from std_msgs.msg import Float64, String, Int32, Int32MultiArray, MultiArrayLayout, MultiArrayDimension
from robot_class import ROBOT
import time
from numpy import sin, cos, pi, zeros, array, sqrt
from numpy.linalg import norm, inv, cond
from numpy.linalg import matrix_rank as rank
import matplotlib.pyplot as plt


pub_calf = rospy.Publisher('/leg/calf_joint_position_controller/command', Float64, queue_size=10)
pub_thigh = rospy.Publisher('/leg/thigh_joint_position_controller/command', Float64, queue_size=10)
pub_hip = rospy.Publisher('/leg/hip_joint_position_controller/command', Float64, queue_size=10)
robot = ROBOT(np.zeros(3), np.zeros(3), "/home/kamiab/catkin_ws/src/simulation/first_leg/scripts/leg_RBDL.urdf")           # TODO: give your own urdf_path
    
rospy.init_node('command', anonymous=True)
import sys
import os
from os.path import expanduser
userdir = os.path.expanduser('~')
home = expanduser("~")
dir = home + '/rbdl/build/python'
sys.path.append(dir)
import rbdl
from robot_class import ROBOT
import time
import numpy as np
from numpy import sin, cos, pi, zeros, array, sqrt
from numpy.linalg import norm, inv, cond
from numpy.linalg import matrix_rank as rank
import matplotlib.pyplot as plt
plt.close('all')

def modelKin(q):
    J = robot.calcJc(np.array(q))
    p = robot.pose_end(np.array(q))
    return [p, J]

time_d = [0.25203080415725726, 0.25403080415725726, 0.25603080415725726, 0.25803080415725727, 0.26003080415725727, 0.26203080415725727, 0.26403080415725727, 0.2660308041572573, 0.2680308041572573, 0.2700308041572573, 0.2720308041572573, 0.2740308041572573, 0.2760308041572573, 0.2780308041572573, 0.2800308041572573, 0.2820308041572573, 0.2840308041572573, 0.2860308041572573, 0.2880308041572573, 0.2900308041572573, 0.2920308041572573, 0.2940308041572573, 0.2960308041572573, 0.2980308041572573, 0.3000308041572573, 0.3020308041572573, 0.3040308041572573, 0.3060308041572573, 0.3080308041572573, 0.3100308041572573, 0.3120308041572573, 0.3140308041572573, 0.3160308041572573, 0.3180308041572573, 0.3200308041572573, 0.3220308041572573, 0.3240308041572573, 0.3260308041572573, 0.3280308041572573, 0.33003080415725733, 0.33203080415725733, 0.33403080415725733, 0.33603080415725733, 0.33803080415725734, 0.34003080415725734, 0.34203080415725734, 0.34403080415725734, 0.34603080415725734, 0.34803080415725735, 0.35003080415725735, 0.35203080415725735, 0.35403080415725735, 0.35603080415725735, 0.35803080415725735, 0.36003080415725736, 0.36203080415725736, 0.36403080415725736, 0.36603080415725736, 0.36803080415725736, 0.37003080415725736, 0.3720308036804202, 0.3730308036804202, 0.3740308036804202, 0.3750308036804202, 0.3760308036804202, 0.3770308036804202, 0.3780308036804202, 0.3790308036804202, 0.3800308036804202, 0.3810308036804202, 0.3820308036804202, 0.3830308036804202, 0.3840308036804202, 0.3850308036804202, 0.3860308036804202, 0.3870308036804202, 0.3880308036804202, 0.3890308036804202, 0.3900308036804202, 0.3910308036804202, 0.3920308036804202, 0.3930308036804202, 0.3940308036804202, 0.3950308036804202, 0.3960308036804202, 0.3970308036804202, 0.3980308036804202, 0.3990308036804202, 0.4000308036804202, 0.4010308036804202, 0.4020308036804202, 0.4030308036804202, 0.4040308036804202, 0.4050308036804202, 0.4060308036804202, 0.4070308036804202, 0.4080308036804202, 0.4090308036804202, 0.4100308036804202, 0.4110308036804202, 0.4120308036804202, 0.4130308036804202, 0.4140308036804202, 0.4150308036804202, 0.4160308036804202, 0.4170308036804202, 0.4180308036804202, 0.4190308036804202, 0.42003080368042023, 0.42103080368042023, 0.42203080368042023, 0.42303080368042023, 0.42403080368042023, 0.42503080368042023, 0.42603080368042023, 0.42703080368042023, 0.42803080368042024, 0.42903080368042024, 0.43003080368042024, 0.43103080368042024, 0.43203080368042024, 0.43303080368042024, 0.43403080368042024, 0.43503080368042024, 0.43603080368042024, 0.43703080368042024, 0.43803080368042024, 0.43903080368042025, 0.44003080368042025, 0.44103080368042025, 0.44203080368042025, 0.44303080368042025, 0.44403080368042025, 0.44503080368042025, 0.44603080368042025, 0.44703080368042025, 0.44803080368042025, 0.44903080368042025, 0.45003080368042025, 0.45103080368042026, 0.45203080368042026, 0.45303080368042026, 0.45403080368042026, 0.45503080368042026, 0.45603080368042026, 0.45703080368042026, 0.45803080368042026, 0.45903080368042026, 0.46003080368042026, 0.46103080368042026, 0.46203080368042027, 0.46303080368042027, 0.46403080368042027, 0.46503080368042027, 0.46603080368042027, 0.46703080368042027, 0.46803080368042027, 0.46903080368042027, 0.4700308036804203, 0.4710308036804203, 0.4720308036804203, 0.4730308036804203, 0.4740308036804203, 0.4750308036804203, 0.4760308036804203, 0.4770308036804203, 0.4780308036804203, 0.4790308036804203, 0.4800308036804203, 0.4810308036804203, 0.4820308036804203, 0.4830308036804203, 0.4840308036804203, 0.4850308036804203, 0.4860308036804203, 0.4870308036804203, 0.4880308036804203, 0.4890308036804203, 0.4900308036804203, 0.4910308036804203, 0.4920308036804203, 0.4930308036804203, 0.4940308036804203, 0.4950308036804203, 0.4960308036804203, 0.4970308036804203, 0.4980308036804203, 0.4990308036804203, 0.5000308036804203, 0.5010308036804203, 0.5020308036804203, 0.5030308036804203, 0.5040308036804203, 0.5050308036804203, 0.5060308036804203, 0.5070308036804203, 0.5080308036804203, 0.5090308036804203, 0.5100308036804203, 0.5110308036804203, 0.5120308036804203, 0.5130308036804203, 0.5140308036804203, 0.5150308036804203, 0.5160308036804203, 0.5170308036804203, 0.5180308036804203, 0.5190308036804203, 0.5200308036804203, 0.5210308036804203, 0.5220308036804203, 0.5230308036804203, 0.5240308036804203, 0.5250308036804203, 0.5260308036804203, 0.5270308036804203, 0.5280308036804203, 0.5290308036804203, 0.5300308036804203, 0.5310308036804203, 0.5320308036804203, 0.5330308036804203, 0.5340308036804203, 0.5350308036804203, 0.5360308036804203, 0.5370308036804203, 0.5380308036804203, 0.5390308036804203, 0.5400308036804203, 0.5410308036804203, 0.5420308036804203, 0.5430308036804203, 0.5440308036804203, 0.5450308036804203, 0.5460308036804203, 0.5470308036804203, 0.5480308036804203, 0.5490308036804203, 0.5500308036804203, 0.5510308036804203, 0.5520308036804203, 0.5530308036804203, 0.5540308036804203, 0.5550308036804203, 0.5560308036804203, 0.5570308036804203, 0.5580308036804204, 0.5590308036804204, 0.5600308036804204, 0.5610308036804204, 0.5620308036804204, 0.5630308036804204, 0.5640308036804204, 0.5650308036804204, 0.5660308036804204, 0.5670308036804204, 0.5680308036804204, 0.5690308036804204, 0.5700308036804204, 0.5710308036804204, 0.5720308036804204, 0.5730308036804204, 0.5740308036804204, 0.5750308036804204, 0.5760308036804204, 0.5770308036804204, 0.5780308036804204, 0.5790308036804204, 0.5800308036804204, 0.5810308036804204, 0.5820308036804204, 0.5830308036804204, 0.5840308036804204, 0.5850308036804204, 0.5860308036804204, 0.5870308036804204, 0.5880308036804204, 0.5890308036804204, 0.5900308036804204, 0.5910308036804204, 0.5920308036804204, 0.5930308036804204, 0.5940308036804204, 0.5950308036804204, 0.5960308036804204, 0.5970308036804204, 0.5980308036804204, 0.5990308036804204, 0.6000308036804204, 0.6010308036804204, 0.6020308036804204, 0.6030308036804204, 0.6040308036804204, 0.6050308036804204, 0.6060308036804204, 0.6070308036804204, 0.6080308036804204, 0.6090308036804204, 0.6100308036804204, 0.6110308036804204, 0.6120308036804204, 0.6130308036804204, 0.6140308036804204, 0.6150308036804204, 0.6160308036804204, 0.6170308036804204, 0.6180308036804204, 0.6190308036804204, 0.6200308036804204, 0.6210308036804204, 0.6220308036804204, 0.6230308036804204, 0.6240308036804204, 0.6250308036804204, 0.6260308036804204, 0.6270308036804204, 0.6280308036804204, 0.6290308036804204, 0.6300308036804204, 0.6310308036804204, 0.6320308036804204, 0.6330308036804204, 0.6340308036804204, 0.6350308036804204, 0.6360308036804204, 0.6370308036804204, 0.6380308036804204, 0.6388130469322211, 0.6408130469322211, 0.6428130469322211, 0.6448130469322211, 0.6468130469322211, 0.6488130469322211, 0.6508130469322211, 0.6528130469322211, 0.6548130469322211, 0.6568130469322211, 0.6588130469322211, 0.6608130469322211, 0.6628130469322211, 0.6648130469322211, 0.6668130469322211, 0.6688130469322211, 0.6708130469322211, 0.6728130469322211, 0.6748130469322211, 0.6768130469322211, 0.6788130469322211, 0.6808130469322211, 0.6828130469322211, 0.6848130469322211, 0.6868130469322211, 0.6888130469322211, 0.6908130469322211, 0.6928130469322211, 0.6948130469322211, 0.6968130469322211, 0.6988130469322211, 0.7008130469322211, 0.7028130469322211, 0.7048130469322211, 0.7068130469322211, 0.7088130469322211, 0.7108130469322211, 0.7128130469322211, 0.7148130469322211, 0.7168130469322211, 0.7188130469322211, 0.7208130469322211, 0.7228130469322211, 0.7248130469322211, 0.7268130469322212, 0.7288130469322212, 0.7308130469322212, 0.7328130469322212, 0.7348130469322212, 0.7368130469322212, 0.7388130469322212, 0.7408130469322212, 0.7428130469322212, 0.7448130469322212, 0.7468130469322212, 0.7488130469322212, 0.7508130469322212]
hip_d = [0.03187720817868999, 0.03187352075728222, 0.03185880913008872, 0.03183309856220681, 0.03179645946309213, 0.03174897311671032, 0.031690750908866624, 0.03162193824704418, 0.031542713715372685, 0.031453287891720194, 0.0313539019335086, 0.031244825961733273, 0.031126357264257148, 0.030998818341068993, 0.03086255481567573, 0.030717933237835983, 0.030565338803410697, 0.030405173017203347, 0.030237851324247198, 0.03006380073413516, 0.029883457463219007, 0.029697264615372847, 0.02950566992203003, 0.029309123560409454, 0.029108076066143677, 0.028902976354371585, 0.028694269861103537, 0.028482396814352617, 0.02826779064225878, 0.028050876523241522, 0.027832070081133836, 0.027611776226314024, 0.027390388142076574, 0.02716828641388622, 0.02694583829773012, 0.02672339712258842, 0.02650130182104567, 0.026279876581204623, 0.02605943061240373, 0.02584025801676995, 0.02562263775830714, 0.025406833721032106, 0.02519309484757596, 0.024981655349945658, 0.024772734988723708, 0.024566539419427408, 0.02436326054262932, 0.02416307692951519, 0.023966154280660592, 0.023772645908791988, 0.023582693242086478, 0.023396426343234796, 0.023213964438628467, 0.023035416451344565, 0.022860881537842517, 0.022690449635999442, 0.02252420199656212, 0.022362211699493525, 0.02220454416557325, 0.022051256443892428, 0.021902388017616504, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.0231, 0.04587429770771913, 0.04622599536596522, 0.04655597372470232, 0.04688734875649798, 0.04722514051280709, 0.04756930867173686, 0.0479196797612125, 0.04827604899263514, 0.04863819175879882, 0.04900586313309053, 0.049378797020420466, 0.04975670532944233, 0.050139277133123494, 0.050526177866466127, 0.050917048578952906, 0.051311505246939934, 0.051709138156662525, 0.052109511372363644, 0.05251216230478493, 0.05291660138821588, 0.053322311812597126, 0.05372874947850858, 0.054135343081409035, 0.05454149435107835, 0.05494657846941861, 0.055349944680752904, 0.055750917107603284, 0.0561487957840888, 0.056542857917942696, 0.05693235939068165, 0.057316536503697425, 0.057694607975932545, 0.05806577719648486, 0.05842923473264988, 0.05878416109089159, 0.059129729724983454, 0.05946511028201576, 0.059789472073241486, 0.06010198775290659, 0.060401837184246146, 0.060688211467906004, 0.06096031710419363, 0.06121738025664825, 0.06145865108069934, 0.06168340808213114, 0.06189096245881127, 0.06208066238417893, 0.062251897187743974, 0.062404101386321964, 0.06253675851984694, 0.06264940474632708, 0.06274163215199645, 0.06281309173502171, 0.06286349602422964, 0.06289262129820207, 0.06290030937467103]
thigh_d = [1.2184460680878344, 1.2183241833327874, 1.2178376367046573, 1.2169863083995396, 1.215770860690101, 1.2141916114188138, 1.2122491812751652, 1.209944642011682, 1.207279513012779, 1.204255752337179, 1.2008757453601948, 1.197142291524587, 1.1930585893713102, 1.1886282200280058, 1.183855129346941, 1.1787436088954635, 1.1732982760101955, 1.1675240531306565, 1.1614261466266669, 1.155010025327857, 1.148281399009222, 1.1412461969819652, 1.1339105469911226, 1.126280754616852, 1.118363283341713, 1.1101647354346251, 1.1016918337882204, 1.0929514048299909, 1.0839503626116915, 1.074695694165749, 1.0651944462022005, 1.0554537132056565, 1.0454806269788655, 1.0352823476679447, 1.0248660562934335, 1.0142389488039272, 1.0034082316638067, 0.9923811189808245, 0.9811648311762257, 0.969766595199915, 0.9581936462940039, 0.9464532313107303, 0.9345526135932745, 0.9224990794468486, 0.910299946499616, 0.8979625744515006, 0.8854943749358746, 0.8729028251265036, 0.8601954832403381, 0.8473800058658795, 0.83446416739856, 0.8214558817974742, 0.8083632268226327, 0.7951944708516056, 0.7819581028280448, 0.7686628665798946, 0.7553177980776491, 0.7419322662489606, 0.7285160188161205, 0.7150791254777873, 0.7016311303626335, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8326364419960496, 0.8455986040566885, 0.8574563693108583, 0.8690845164484617, 0.880664360389648, 0.8921934310190928, 0.9036651668154013, 0.9150726019917705, 0.9264087857750454, 0.9376667844030595, 0.9488396716730133, 0.9599205203003028, 0.9709023929148789, 0.9817783339741172, 0.9925413628022169, 1.0031844675882717, 1.0137006003306772, 1.0240826728050516, 1.0343235536303277, 1.0444160663153224, 1.0543529866834467, 1.064127043576448, 1.07373092006592, 1.0831572555411082, 1.092398648935086, 1.1014476631261618, 1.1102968305353527, 1.1189386599378903, 1.1273656445020654, 1.135570271062192, 1.1435450306250103, 1.1512824300995934, 1.1587750052326524, 1.166015334717586, 1.172996055433645, 1.1797098787595768, 1.1861496078922775, 1.1923081560870523, 1.198178565722675, 1.2037540280798742, 1.2090279037085832, 1.2139937432463652, 1.218645308534471, 1.222976593862393, 1.2269818472347083, 1.2306555913911863, 1.2339926444364182, 1.2369881398996128, 1.239637546032184, 1.2419366841564832, 1.2438817458841422, 1.2454693090294784, 1.2466963520530787, 1.2475602668829326, 1.2480588699753348, 1.2481904114948408]
calf_d = [-1.8429096423381035, -1.8427419885008873, -1.8420726021618918, -1.8409008293746782, -1.8392267279000039, -1.8370495204291692, -1.8343684902906194, -1.831183194070029, -1.8274934684943875, -1.8232994324920888, -1.8186014885588695, -1.8134003239270493, -1.8076969115429071, -1.801492510842654, -1.7947886683178846, -1.7875872178634997, -1.779890280903879, -1.7717002662959809, -1.763019870007815, -1.7538520745686113, -1.7442001483634968, -1.7340676447118606, -1.7234584007610574, -1.712376536243081, -1.7008264521170213, -1.688812829129725, -1.6763406263346659, -1.6634150796139402, -1.6500417002538332, -1.6362262736298765, -1.62197485806264, -1.607293783911316, -1.592189652978028, -1.5766693383019208, -1.5607399844270053, -1.544409008235777, -1.527684100449731, -1.5105732279039712, -1.4930846367110044, -1.475226856439054, -1.4570087054400058, -1.4384392974728681, -1.4195280497774274, -1.4002846927860249, -1.380719282101329, -1.3608422137050742, -1.3406642372688167, -1.3201964751273958, -1.2994504441321526, -1.2784380804107802, -1.257171767629402, -1.235664369248262, -1.2139292651724178, -1.1919803930956685, -1.1698322955898066, -1.147500175160349, -1.1249999550318561, -1.1023483468054598, -1.0795629275931387, -1.056662042944891, -1.033663352596123, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.2, -1.199590413830702, -1.220754498681424, -1.2400338869199816, -1.2588630078659233, -1.2775369312886595, -1.2960513899340322, -1.3143956653168014, -1.3325585900289643, -1.3505292307919496, -1.3682968967398885, -1.3858511292423297, -1.4031816929157641, -1.4202785659182713, -1.4371319314760502, -1.4537321708688005, -1.4700698575064317, -1.4861357519734952, -1.501920798052226, -1.5174161197256977, -1.5326130188691867, -1.5475029711265662, -1.5620776257501519, -1.5763288050816457, -1.590248504143232, -1.6038288906363265, -1.6170623053092517, -1.629941262638677, -1.642458451774784, -1.6546067377043079, -1.6663791625888604, -1.6777689472396433, -1.688769492692505, -1.6993743818533884, -1.709577381184137, -1.7193724424022891, -1.7287537041732408, -1.737715493776231, -1.7462523287291667, -1.7543589183618242, -1.7620301653297672, -1.7692611670653224, -1.7760472171655042, -1.782383806714757, -1.788266625537154, -1.7936915634734485, -1.7986547115695792, -1.80315236324405, -1.8071810154586536, -1.8107373699016767, -1.8138183341988616, -1.8164210231684597, -1.8185427601360482, -1.820181078323552, -1.8213337223250539, -1.8219986496797562, -1.822174032549623]
'''@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'''
hip_vel_d = [0.0009083515161786362, -0.004599959557831981, -0.010109546488561837, -0.01559342257339665, -0.02103886743735278, -0.02643718619768191, -0.031771253497386166, -0.03702423758346921, -0.04217982527726903, -0.0472223565827583, -0.05213693071594144, -0.05690950185583549, -0.06152696396791713, -0.06597722388036799, -0.07024926197730832, -0.07433318010731521, -0.07822023654231375, -0.0819028680501284, -0.08537469950662167, -0.08863054099514427, -0.09166637352219065, -0.09447932449294806, -0.09706763314395889, -0.09943060719646589, -0.10156857195896302, -0.10348281295179974, -0.10517551320776437, -0.1066496863983285, -0.10790910690233169, -0.10895823788868995, -0.10980215841990487, -0.11044649050571284, -0.11089732694995887, -0.1111611607495407, -0.11124481670286947, -0.11115538577145088, -0.1109001626596753, -0.11048658699544894, -0.10992218839097753, -0.10921453558249793, -0.1083711897767902, -0.10739966227483497, -0.10630737638566343, -0.10510163311456265, -0.10378957398720896, -0.10237816697537372, -0.10087418738255251, -0.09928418695665338, -0.097614481847052, -0.09587114130226546, -0.0940599785558513, -0.09218654428890768, -0.09025612327801709, -0.08827373329880014, -0.0862441201023665, -0.08417175845047023, -0.08206086176960006, -0.07991538652635803, -0.07773903595517334, -0.07553768598961351, -0.07332442968337786, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.17585512608226972, 0.1706011999629627, 0.1641278574962176, 0.16727948976370152, 0.1704938615956102, 0.17364281413950208, 0.176694496570624, 0.17963884317084283, 0.18246588077930448, 0.18516524138118218, 0.18772613291425574, 0.19013734703267282, 0.19238726195552056, 0.1944638678347681, 0.1963547953620465, 0.19804734802308424, 0.19952854094979444, 0.2007851468678384, 0.20180375242308413, 0.2025707917592097, 0.20307261727473694, 0.20329559474665887, 0.20322616803860402, 0.20285094402609402, 0.20215678547784335, 0.2011309106070722, 0.19976099892399404, 0.19803530289955032, 0.1959427647874133, 0.19347313779918715, 0.1906171106599884, 0.18736643444568948, 0.1837140504138449, 0.17965421735084386, 0.1751826368752481, 0.1702965749958934, 0.16499497809866448, 0.1592785814735075, 0.15315000842787563, 0.14661385800611693, 0.13967677936638123, 0.1323475309174836, 0.12463702199494896, 0.11655833702773233, 0.10812673908516254, 0.0993596510171066, 0.09027661539317611, 0.08089923147823389, 0.07125106902919408, 0.06135755913808921, 0.05124586266253138, 0.04094471719211715, 0.030484263905786586, 0.01989585607107596, 0.00921185130764239, -0.0015346099252885066]
thigh_vel_d = [0.03002152946369792, -0.15206459210294376, -0.33449154312848567, -0.5167243222309706, -0.6986957847473142, -0.880468292739763, -1.0618176492396318, -1.2425185822841107, -1.4223492695795459, -1.601093061616789, -1.7785394751379642, -1.9544850957801059, -2.1287343947911097, -2.301100453284992, -2.471405587535303, -2.6394818704049534, -2.805171545767176, -2.9683273344680696, -3.1288126374298653, -3.2865016185111795, -3.441279186744948, -3.5930408957349727, -3.741692738944841, -3.8871508554669387, -4.029341158384033, -4.168198890940343, -4.303668118402926, -4.435701163742914, -4.564257995047342, -4.689305572438843, -4.810817161841493, -4.928771622346151, -5.04315267324981, -5.153948146457281, -5.261149228907265, -5.364749697999076, -5.464745152797257, -5.561132243377401, -5.653907899034208, -5.743068555167035, -5.828609377924055, -5.910523485339664, -5.98880116308231, -6.0634290445483625, -6.134388856468984, -6.201657227048225, -6.265205049094475, -6.324995834967399, -6.380984917127, -6.433118456274722, -6.481332332430047, -6.525550939690422, -6.565685929092637, -6.601634841676013, -6.633279151524722, -6.6604824001114915, -6.683088706564953, -6.7009205925065345, -6.713776389501281, -6.72164440022536, -6.725208760943649, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6.568193022710496, 6.2050897692662, 5.8275281002103805, 5.801673227027615, 5.777442804586799, 5.750509418113698, 5.720098549536808, 5.686207528221633, 5.648846403723052, 5.608021398192281, 5.5637340739994485, 5.515981610349738, 5.464756846455437, 5.410048868309926, 5.351843527855985, 5.290123909307154, 5.224870821103508, 5.156063316947332, 5.083679319922425, 5.007695515407431, 4.928088073951881, 4.844833758580265, 4.7579101120495055, 4.667296000215767, 4.572972193867484, 4.474921961790982, 4.373131673602926, 4.267591410560135, 4.158295581493803, 4.045243540399068, 3.9284402013801634, 3.8078966467652973, 3.6836307229524574, 3.5556676173497808, 3.42404041059752, 3.2887905975961953, 3.149968570289408, 3.0076340554273076, 2.861856500282593, 2.7127153992839173, 2.560300555043773, 2.404712267475646, 2.246061437548696, 2.084469609552408, 1.9200689166961495, 1.753001917432567, 1.583421358207491, 1.4114898403423988, 1.237379391826639, 1.0612709470312829, 0.8833537371801479, 0.7038245957415667, 0.5228871842261416, 0.3407511451810881, 0.15763119037845624, -0.02625386670834122]
calf_vel_d = [-0.041293258848257325, 0.20917505267098496, 0.4602651462554287, 0.7114240642749257, 0.9627406749567355, 1.214480440516077, 1.4665109763881783, 1.718693337647678, 1.9708868150738352, 2.222949956997267, 2.4747406801952967, 2.726116364642567, 2.976933951698735, 3.227050047269143, 3.4763210290473032, 3.7246031565904216, 3.971752682811618, 4.217625965256965, 4.462079583058265, 4.704970430409068, 4.946155807420281, 5.185493525543178, 5.422841986986773, 5.658060247048187, 5.8910080639756215, 6.121545930311775, 6.349535082987226, 6.57483748960748, 6.797315808137029, 7.016833317310969, 7.2332538149978856, 7.446441481591491, 7.656260705365561, 7.862575867141348, 8.065251081155628, 8.264149887564868, 8.459134892826635, 8.650067354712474, 8.836806707292826, 9.019210020866181, 9.197131391634903, 9.370421256296925, 9.538925626601232, 9.70248519422223, 9.860933661929439, 10.014097695371492, 10.161796117943068, 10.303837393442295, 10.440018389186699, 10.57012276024361, 10.693919072657586, 10.811158698334571, 10.921573555610625, 11.024873601794818, 11.120743271889895, 11.208837986493517, 11.288781226753315, 11.36016039945471, 11.422521922417962, 11.47573661066789, 11.520874508436862, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -10.74756925411369, -10.109272708766593, -9.455544344941009, -9.375262762963079, -9.29746133866709, -9.2151857883352, -9.12728368622358, -9.033854389119812, -8.93502032181078, -8.830900269909796, -8.721608015915244, -8.607252717141286, -8.487938887963042, -8.363767193153572, -8.234835081826374, -8.101237286951518, -7.963066311583795, -7.820412904663137, -7.673366636022389, -7.522015312803973, -7.3664456149737525, -7.206744231677941, -7.0429975601756, -6.875291895362519, -6.703713628560709, -6.528349417878977, -6.349286332231496, -6.166611971470898, -5.980414564411065, -5.790783046517133, -5.597807118731288, -5.401577289924803, -5.202184904465422, -4.999722155453944, -4.794282086014596, -4.585958580594721, -4.374846347803422, -4.16104089692795, -3.9446385099389145, -3.7257362106237215, -3.504431732816335, -3.2808234893853734, -3.0550105331090895, -2.8270925503865207, -2.5971698465673025, -2.3653433119740455, -2.1317144209442738, -1.8963852355834354, -1.6594584155147394, -1.4210372358327055, -1.1812256131069543, -0.9401281389579825, -0.6978501204266637, -0.4544976261172395, -0.2101775368460223, 0.035002400693876515]


n   = 3 # number of links
path =  "/home/nooshin/minicheetah/src/first_leg/scripts/leg_RBDL.urdf"
robot = ROBOT(np.zeros((3, 1)), np.zeros((3, 1)), path) #model

#q = np.array([-0., 0., -pi/6])
q_home = np.array([0.03336, 1.2655, -1.929])    # zero position given from the real robot now 
slider = []
t_pre = time.time()
i = 0
h = []
model = rbdl.loadModel('/home/lenovo/python_simulation/python_simulation/legRBDL.urdf')
def get_state(data):
    global q_home,model  
    q = data.position
    q = np.asarray(q)
    q_rbdl = np.zeros(4)
    # q_rbdl[0] = q[2]    #slider height (origin 0.9)
    # q_rbdl[1] = q[1]    #hip joint
    # q_rbdl[2] = q[3]    #thigh joint
    # q_rbdl[3] = q[0]    # calf joint
    q_rbdl[0] = q[1]
    q_rbdl[1] = q[2]
    q_rbdl[2] = q[0]
    qdot = data.velocity
    qdot = np.asarray(qdot)
    qdot_rbdl = np.zeros(4)
    qdot_rbdl[0] = qdot[2]
    qdot_rbdl[1] = qdot[1]
    qdot_rbdl[2] = qdot[3]
    qdot_rbdl[3] = qdot[0]
    # qdot_rbdl[0] = qdot[1]
    # qdot_rbdl[1] = qdot[2]
    # qdot_rbdl[2] = qdot[0]

    pub_hip.publish(q_home[0])
    pub_thigh.publish(q_home[1])
    pub_calf.publish(q_home[2])
    slider.append(rbdl.CalcBodyToBaseCoordinates(model, q_rbdl, model.GetBodyId('jump'), np.zeros(3))[2]+0.9)
    vel = rbdl.CalcPointVelocity(model, q_rbdl, qdot_rbdl, model.GetBodyId('jump'), np.zeros(3))
    if time.time()-t_pre>5:
        for i in range(len(calf_d)):
            pub_hip.publish(hip_d[i])
            pub_thigh.publish(thigh_d[i])
            pub_calf.publish(calf_d[i])
            rospy.sleep(0.00001)
            if i == len(calf_d)-1: pass
    h.append(-robot.pose_end(q_rbdl)[2])        



# print(len(hip_d))
# print(len(thigh_d))
# print(len(calf_d))

    
 

def main():
    rospy.Subscriber("/leg/joint_states", JointState, get_state)
    rospy.spin()
    if rospy.is_shutdown():
        plt.figure()
        plt.plot(h)
        plt.show()
        # print("DOWN")




if __name__=="__main__":
    try:
        main()
    except rospy.ROSInternalException:
        pass